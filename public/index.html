<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bç«™çƒ­é—¨è§†é¢‘èšåˆæ¦œ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Microsoft YaHei", sans-serif;
      background: #f9f9f9;
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 25px;
    }
    h1 {
      color: #fb7299;
      margin: 10px 0;
      font-size: 24px;
    }
    .subtitle {
      color: #666;
      font-size: 14px;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 24px;
      background: #00a1d6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #008ecf;
    }
    #status {
      text-align: center;
      margin: 15px 0;
      min-height: 24px;
      font-weight: bold;
      color: #e74c3c;
    }
    .video-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .video-card {
      background: white;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .video-link {
      display: block;
      text-decoration: none;
      color: inherit;
    }
    .video-title {
      font-size: 16px;
      font-weight: bold;
      color: #e9190f;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .video-meta {
      font-size: 13px;
      color: #666;
      margin-bottom: 10px;
    }
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 12px;
      color: #888;
    }
    .stat-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ”¥ Bç«™çƒ­é—¨è§†é¢‘èšåˆæ¦œ</h1>
      <p class="subtitle">å…¨ç«™çƒ­é—¨ + æ¯å‘¨å¿…çœ‹ + ä¸‰æ—¥æ’è¡Œæ¦œ | çº¯æ–‡å­— </p>
    </header>

    <div class="controls">
      <button onclick="loadData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    </div>

    <div id="status">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åŠ è½½æ•°æ®...</div>
    <div class="video-list" id="list"></div>
  </div>

  <script>
    function formatNumber(num) {
      if (num >= 1e8) return (num / 1e8).toFixed(1) + 'äº¿';
      if (num >= 1e4) return (num / 1e4).toFixed(1) + 'ä¸‡';
      return num.toLocaleString();
    }

    function formatDate(timestamp) {
      if (!timestamp) return 'æœªçŸ¥';
      const date = new Date(timestamp * 1000);
      return date.getFullYear() + '-' +
        String(date.getMonth() + 1).padStart(2, '0') + '-' +
        String(date.getDate()).padStart(2, '0');
    }

    async function loadData() {
      const status = document.getElementById('status');
      const list = document.getElementById('list');
      status.textContent = 'â³ æ­£åœ¨åŠ è½½å¤šæ¦œå•æ•°æ®...';
      list.innerHTML = '';

      try {
        const res = await fetch('/api/popular');
        const data = await res.json();

        if (data.code !== 0) throw new Error(data.message || 'æ¥å£å¼‚å¸¸');

        let videos = data.data.list;

        // æŒ‰æ’­æ”¾é‡ä»é«˜åˆ°ä½æ’åº
        videos.sort((a, b) => (b.stat?.view || 0) - (a.stat?.view || 0));

        list.innerHTML = videos.map((v, i) => {
          const url = `https://www.bilibili.com/video/${v.bvid}`;
          const pubDate = formatDate(v.pubdate || v.ctime);

          return `
            <div class="video-card">
              <a class="video-link" href="${url}" target="_blank" rel="noopener">
                <div class="video-title">${i + 1}. ${v.title}</div>
                <div class="video-meta">
                  UPä¸»: ${v.owner?.name || 'æœªçŸ¥'} | å‘å¸ƒæ—¶é—´: ${pubDate}
                </div>
                <div class="stats">
                  <div class="stat-item">ğŸ‘€ æ’­æ”¾: ${formatNumber(v.stat?.view || 0)}</div>
                  <div class="stat-item">ğŸ’¬ å¼¹å¹•: ${formatNumber(v.stat?.danmaku || 0)}</div>
                  <div class="stat-item">ğŸ‘ ç‚¹èµ: ${formatNumber(v.stat?.like || 0)}</div>
                  <div class="stat-item">ğŸ’° æŠ•å¸: ${formatNumber(v.stat?.coin || 0)}</div>
                  <div class="stat-item">â­ æ”¶è—: ${formatNumber(v.stat?.favorite || 0)}</div>
                </div>
              </a>
            </div>
          `;
        }).join('');

        status.textContent = `âœ… åŠ è½½æˆåŠŸï¼å…± ${videos.length} æ¡ï¼ˆå·²æŒ‰æ’­æ”¾é‡æ’åºï¼‰`;
      } catch (err) {
        console.error('âŒ åŠ è½½å¤±è´¥:', err);
        status.textContent = `âŒ åŠ è½½å¤±è´¥: ${err.message}`;
      }
    }
  </script>
</body>
</html>
